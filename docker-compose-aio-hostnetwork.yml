services:
  ## Host network mode - Direct access to host network stack
  ## This configuration is useful for local development or when you need direct network access
  ## Note: Port mappings are not needed/ignored when using host network mode

  aceserve:
    image: jopsis/aceserve:latest
    container_name: aceserve-engine
    network_mode: host
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "sh", "-c", "nc -z 127.0.0.1 6878 && nc -z 127.0.0.1 62062 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
    dns:
      # - 74.115.172.133
      - 1.1.1.1
      - 1.0.0.1
  httproxy:
    # build:
    #   context: .
    #   dockerfile: Dockerfile
    image: jopsis/httpaceproxy:latest
    container_name: httpaceproxy
    network_mode: host
    environment:
      # With host network mode, services communicate via localhost
      - ACE_HOST=127.0.0.1
      - ACE_API_PORT=62062
      - ACE_HTTP_PORT=6878
      # Connection limits - Adjust based on your needs (see CONNECTION-LIMITS.md)
      - MAX_CONNECTIONS=10           # Total clients (Personal: 10, Family: 25, Server: 100+)
      - MAX_CONCURRENT_CHANNELS=5    # Different channels (Personal: 3-5, Family: 5-10, Server: 15-20)
      # Plugin control - Specify which plugins to enable
      # Options: 'all' (default), 'newera,acepl,stat', 'stat,statplugin', etc.
      # Available: newera, elcano, acepl, stat, statplugin, misterchire
      - ENABLED_PLUGINS=newera,elcano,stat,statplugin,misterchire,af1c1onados,aio
      # Plugin playlist URLs (optional - uses defaults if not set)
      # - NEWERA_PLAYLIST_URL=https://your-custom-url/playlist.m3u
      # - ELCANO_PLAYLIST_URL=https://your-custom-url/playlist.m3u
    depends_on:
      aceserve:
        condition: service_healthy   # Wait for aceserve to be healthy before starting
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://127.0.0.1:8888/stat"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s

# Note: No networks section needed when using host network mode
# All services share the host's network stack and communicate via localhost

## IMPORTANT: Host network mode notes
## - Services will bind directly to host ports (6878, 62062, 8621, 8888)
## - Make sure these ports are not already in use on your host
## - Access HTTPAceProxy at: http://localhost:8888
## - Access AceStream Engine at: http://localhost:6878
## - This mode is NOT supported on Docker Desktop for Mac/Windows (use bridge mode instead)
## - On Linux, this provides better performance and simpler networking
