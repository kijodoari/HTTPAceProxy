services:
  ## Uncomment the appropriate aceserve service based on your system architecture
  ## For x64 systems (AMD64/Intel):
  aceserve:
    image: jopsis/aceserve:x64-latest
    platform: linux/amd64
    container_name: aceserve-engine
    ports:
      - "6878:6878"    # AceStream HTTP port
      - "62062:62062"  # AceStream API port
    restart: unless-stopped
    networks:
      - aceproxy-net
    healthcheck:
      test: ["CMD", "sh", "-c", "nc -z localhost 6878 && nc -z localhost 62062 || exit 1"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s
  ## For ARM64 systems (Raspberry Pi 4, Apple Silicon):
  # aceserve:
  #   image: jopsis/aceserve:arm64-latest
  #   platform: linux/arm64
  #   container_name: aceserve-engine
  #   ports:
  #     - "6878:6878"    # AceStream HTTP port
  #     - "62062:62062"  # AceStream API port
  #   restart: unless-stopped
  #   networks:
  #     - aceproxy-net
  #   healthcheck:
  #     test: ["CMD", "sh", "-c", "nc -z localhost 6878 && nc -z localhost 62062 || exit 1"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #     start_period: 30s
  ## For ARM32 systems (Raspberry Pi 3 and older):
  # aceserve:
  #   image: jopsis/aceserve:arm32-latest
  #   platform: linux/arm/v7
  #   container_name: aceserve-engine
  #   ports:
  #     - "6878:6878"    # AceStream HTTP port
  #     - "62062:62062"  # AceStream API port
  #   restart: unless-stopped
  #   networks:
  #     - aceproxy-net
  #   healthcheck:
  #     test: ["CMD", "sh", "-c", "nc -z localhost 6878 && nc -z localhost 62062 || exit 1"]
  #     interval: 10s
  #     timeout: 5s
  #     retries: 5
  #     start_period: 30s
  httproxy:
    build:
      context: .
      dockerfile: Dockerfile
    # image: jopsis/httpaceproxy:latest
    container_name: httpaceproxy
    ports:
      - "8888:8888"    # HTTPAceProxy web interface
    environment:
      - ACE_HOST=aceserve
      - ACE_API_PORT=62062
      - ACE_HTTP_PORT=6878
      # Connection limits - Adjust based on your needs (see CONNECTION-LIMITS.md)
      - MAX_CONNECTIONS=10           # Total clients (Personal: 10, Family: 25, Server: 100+)
      - MAX_CONCURRENT_CHANNELS=5    # Different channels (Personal: 3-5, Family: 5-10, Server: 15-20)
    depends_on:
      aceserve:
        condition: service_healthy   # Wait for aceserve to be healthy before starting
    restart: unless-stopped
    networks:
      - aceproxy-net

networks:
  aceproxy-net:
    driver: bridge